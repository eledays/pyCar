<!-- Продолжение -->
{% extends "level.html" %}
{% block extraVars %}
    <script>
        var levelId = 2;
        var fixedCamera = true;

        basePythonCode = `
import asyncio


async def _process_tasks():
    while True:
        task = await task_queue.get()
        await task
        task_queue.task_done()


task_queue = asyncio.Queue()
asyncio.create_task(_process_tasks())


class Car:
    def __init__(self):
        self.power = 0
        self.engine_started = True
        self.wheel_angle = 0

    def move(self):
        task_queue.put_nowait(self._move())

    async def _move(self):
        self.power = 1

    def stop(self):
        task_queue.put_nowait(self._stop())

    async def _stop(self):
        self.power = 0


def sleep(seconds):
    task_queue.put_nowait(asyncio.sleep(seconds))


car = Car()
`;
        baseCodeEditorText = '';

        var objects = [
            {
                id: null, 
                type: 'car', 
                x: window.innerWidth / 4, 
                y: window.innerHeight - 100, 
                width: 80, 
                height: 40,
                rotate: 0
            },
        ];

        messages = [
            ['Часто может возникнуть ситуация, в которой нужно сделать паузу', 0],
            ['Например, сейчас твоя задача — поехать и остановиться через 3 секунд', 3000],
            ['Чтобы сделать паузу, используется функция <span class="codeText">sleep</span>', 5000],
            ['Напомним, что чтобы вызвать функцию, нужно написать её название и скобки. В скобках можно указать аргументы. Например, функция <span class="codeText">sleep</span> принимает количество секунд, на которое нужно остановиться', 8000],
            ['<span class="codeText">sleep(3)</span> — строчка, которая остановит выполнение кода на 3 секунд', 11000],
            ['Далее', 13000, () => addMessage('Сейчас твоя задача — заставить автомобиль поехать и остановиться через 3 секунд. Если написать несколько строк кода, они будут выполняться друг за другом. Если встретится <span class="codeText">sleep</span> — программа остановится, а через заданное время пойдет дальше по строчкам')]
        ];

        const iId = setInterval(() => {
            let velocity = Body.getVelocity(car);
            let currentSpeedX = velocity.x;
            let currentSpeedY = velocity.y;

            if (currentSpeedX || currentSpeedY) {
                clearInterval(iId);
                
                setTimeout(() => {
                    setInterval(() => {
                        let velocity = Body.getVelocity(car);
                        let currentSpeedX = velocity.x;
                        let currentSpeedY = velocity.y;
                        if (!currentSpeedX && !currentSpeedY) {
                            levelEnd();
                        }
                    }, 100);
                }, 3000);
            }
        }, 100);
    </script>
{% endblock %}